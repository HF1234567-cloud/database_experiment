<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>查询/修改资讯信息</title>
    <link href="../../static/css/index.css" type="text/css" rel="stylesheet"/>
    <link rel="stylesheet" href="../../static/layui/css/layui.css"/>
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <!--头部导航栏-->
    <div id="head" th:replace="~{common/header :: common_head(user=${session.user})}"></div>
    <!--左边菜单栏-->
    <div id="left_column" th:replace="~{common/left_column :: left_column(menuList=${session.menuList})}"></div>
    <!-- 内容主体区域 -->
    <div class="layui-body">
        <div style="padding: 15px;">

            <div class="information_column">
                <div class="information_top">
                    首页咨询消息详情
                    <hr>
                </div>
                <div class="layui-form-item" pane="">
                    <label class="layui-form-label role_title">资讯消息显示:</label>
                    <div class="layui-input-block">
                        <input type="radio" class="role_input left_input" name="roleType" value="3"
                               th:checked="${information.roleId} == '3'" th:disabled="${information.id != null}"><span class="label">学生端</span>
                        <input type="radio" class="role_input" name="roleType" value="2"
                               th:checked="${information.roleId} == '2'" th:disabled="${information.id != null}"><span class="label">教师端</span>
                        <input type="radio" class="role_input" name="roleType" value="1"
                               th:checked="${information.roleId} == '1'" th:disabled="${information.id != null}"><span class="label">管理端</span>
                    </div>
                </div>
                <div class="information_title">
                    <label class="layui-form-label">标题:</label>
                    <div class="layui-input-block">
                        <input type="text" name="title" id="title" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input" th:value="${information.title}">
                    </div>
                </div>
                <div class="information_content">
                    <label class="layui-form-label">内容:</label>
                    <div class="layui-input-block">
                        <textarea placeholder="请输入内容" id="content" class="layui-textarea" >[[${information.content}]]</textarea>
                    </div>
                </div>
                <div class="information_date">
                    <label class="layui-form-label" >发布日期:</label>
                    <div class="layui-input-inline">
                        <input type="text" class="layui-input" id="test11" placeholder="yyyy年MM月dd日" th:value="${information.publishDate}"  th:disabled="${information.id != null}">
                    </div>
                </div>
                <div class="information_sub">
                    <button type="button" class="layui-btn layui-btn-primary" th:if="${information.id != null}" onclick="updateInformation()">修改资讯信息</button>
                    <button type="button" class="layui-btn layui-btn-primary" th:if="${information.id == null}" onclick="addInformation()">发布资讯信息</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../../static/layui/layui.all.js"/>
<script></script>
</body>
<script th:inline="javascript">
    layui.use(['form', 'layer'], function(){
        var form = layui.form ,
            layer = layui.layer ;

        //修改资讯信息
         window.updateInformation = function() {
            var id = [[${information.id}]]
            var title = document.getElementById("title").value;
            var content = document.getElementById("content").value;
             var data = {
                 'id': id,
                 'title': title,
                 'content': content
             };
             data = JSON.stringify(data);
             layui.jquery.ajax({
                 url: '/manage/updateInformation',
                 method: 'post',
                 data: data,
                 contentType: "application/json;charset=utf-8",
                 traditional: true,
                 dataType: 'text',
                 success: function (res) {
                     res = JSON.parse(res)
                     if(res.code == '201'){
                         layer.msg(res.msg)
                     }else{
                         window.location.href="/manage/information";
                         layer.msg(res.data)
                     }
                 }
             });
        };

         //添加资讯信息
         window.addInformation = function () {
            var title = document.getElementById("title").value;
            var content = document.getElementById("content").value;
            var checkedRadio = document.querySelector('input[name="roleType"]:checked');
            var roleType = checkedRadio ? checkedRadio.value : '';
            if(!roleType){
                layer.msg('请选择资讯展示端');
                return;
            }
             if(!title || !content){
                 layer.msg('标题和内容不能为空');
                 return;
             }
             var data = {
                 'title': title,
                 'content': content,
                 'roleType': roleType
             };
             data = JSON.stringify(data);
             layui.jquery.ajax({
                 url: '/manage/addInformation',
                 method: 'post',
                 data: data,
                 contentType: "application/json;charset=utf-8",
                 traditional: true,
                 dataType: 'text',
                 success: function (res) {
                     res = JSON.parse(res)
                     if(res.code == '201'){
                         layer.msg(res.message || '发布失败')
                     }else{
                         layer.msg(res.data || '发布成功', {time:1000}, function(){
                             window.location.href="/manage/information";
                         });
                     }
                 }
             });
         }
    });
</script>
</html>